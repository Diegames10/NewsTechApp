<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Publicar Not√≠cia</title>

  <!-- SQLite em WASM e camada de banco -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/Portal.noticias.css') }}">
  

</head>
<body>
  <header>
    <h1>Publicar Nova Not√≠cia</h1>
    <nav>
      <a href="{{ url_for('auth.home') }}" class="nav-link">‚¨Ö Voltar ao Portal</a>
      <div class="perfil-container">
        <button id="perfil-btn" type="button">
          <img id="avatar" src="{{ url_for('static', filename='imagens/avatar-default.png') }}" alt="Perfil">
          <span id="perfil-nome">Entrar</span> ‚ñæ
        </button>
        <div class="perfil-menu" id="perfil-menu">
          <div class="perfil-info">
            <img id="menu-avatar" src="{{ url_for('static', filename='imagens/avatar-default.png') }}" alt="Foto de perfil">
            <strong id="menu-nome">Visitante</strong>
          </div>
          <hr>
          <button id="toggle-tema" type="button">üåô Modo Escuro</button>
          <button id="btn-sair" style="display:none;" type="button">üö™ Sair</button>
        </div>
      </div>
    </nav>
  </header>

  <main class="escritor-container">
   <form id="form-post" class="form-noticia" enctype="multipart/form-data">
      <input type="hidden" id="id" name="id">
    
      <div class="campo">
        <label for="titulo">T√≠tulo da not√≠cia</label>
        <input type="text" id="titulo" name="titulo" required>
      </div>
    
      <div class="campo">
        <label for="autor">Autor</label>
        <input type="text" id="autor" name="autor" required>
      </div>
    
      <div class="campo">
        <label for="conteudo">Conte√∫do</label>
        <textarea id="conteudo" name="conteudo" rows="6" required></textarea>
      </div>
    
      <div class="campo">
        <label for="image">Imagem da Not√≠cia</label>
        <input type="file" id="image" name="image" accept="image/*">
      </div>
    
      <button type="submit" class="btn-publicar">üì¢ Publicar not√≠cia</button>
    </form>

  </main>

  <footer>
    <p>¬© 2025 Portal de Not√≠cias - Criado por Bruna Oliveira e Diego Andrioli</p>
  </footer>
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/publicar.api.js') }}">
    async function fetchMe() {
  try {
    const r = await fetch('/api/me', { headers: {'Accept':'application/json'} });
    if (!r.ok) throw 0;
    return await r.json();
  } catch { return { loggedIn:false }; }
}

(async () => {
  const me = await fetchMe();
  if (!me.loggedIn) {
    alert('Fa√ßa login para publicar/editar.');
    window.location.href = '/login'; // ajuste a rota do seu login
    return;
  }

  // Preenche autor
  const autorEl = document.getElementById('autor'); // id do input Autor
  if (autorEl) {
    autorEl.value = me.name || 'Usu√°rio';
    autorEl.readOnly = true;        // evita edi√ß√£o
  }

  // Carrega post se tiver ?id=
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  if (id) {
    const r = await fetch(`/api/posts/${id}`, { headers: {'Accept':'application/json'} });
    if (r.ok) {
      const p = await r.json();
      document.getElementById('titulo').value = p.titulo || '';
      document.getElementById('conteudo').value = p.conteudo || '';
      // autor j√° vem travado com o logado ‚Äî o backend tamb√©m refor√ßa
      if (p.image_url) {
        const prev = document.getElementById('edit-preview') || document.getElementById('preview');
        if (prev) {
          prev.src = p.image_url;
          prev.style.display = 'block';
        }
      }
    }
  }
})();

    
  </script>
  
</body>
</html>











